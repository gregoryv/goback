<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<title>Backend development</title>
<style>html, body {
margin: 0 0;
padding: 0 0;
background-color: #fff;
}
.page {
height: 100vh;
position: relative;
margin-bottom: 1vh;
}
.page .view {
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 2vh;
}
.page .footer {
position: absolute;
bottom: 0;
left: 0;
right: 0;
text-align: center;
height: 2vh;
}
.page .footer .next {
position: absolute;
right: 1em;
cursor: pointer;
}
.page .footer .prev {
position: absolute;
left: 1em;
cursor: pointer;
}
.page .view {
font-size: 2vw;
margin: 0 0;
padding: 0 0;
}
.page .view .header {
text-align: center;
height: 14vh;
overflow: hidden;
}
.header {
background-image: url('img/blue_gopher.svg');
background-repeat: no-repeat;
background-position: 80px 10px;
}
.header h1, .header h2, .header .group {
font-weight: bold;
margin-top: 3vh;
font-size: 5vh;
margin-bottom: 0vh;
}
.header h3 {
margin-top: 0vh;
font-size: 3vh;
}
.page .view .slide {
margin: auto;
padding: 0.8vw 1.6vw 0.8vw 1.6vw;
height: 79vh;
overflow: hidden;
}
.page .view .cover {
display: flex;
justify-content: center;
align-items: center;
height: 82vh;
text-align: center;
}
.toc {
position: absolute;
left: 27vw;
width: 55vw;
padding-top: 1em;
}
.toc ul {
margin-top: 0;
}
a {
text-decoration: none;
color: #000;
}
a:hover {
text-decoration: underline;
}
.h3 {
margin-left: 5vw;
list-style-type: circle;
}
.trail {
position: absolute;
height: 6px;
width: 6px;
border-radius: 3px;
background: red;
}
.outline {
border: 1px solid black;
}
.center {
text-align: center;
}
.double {
}
.column.left {
position: absolute;
left: 4vw;
width: 40vw;
}
.column.right {
position: absolute;
left: 50vw;
width: 40vw;
}
.srcfile {
margin-top: 1.6em;
margin-bottom: 1.6em;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAMAAAB1cTk3AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAjVBMVEX9/fz4+Pb19fP8/Pz39/Xp6ejr6+rs7Ov29vTt7evo6Oj6+vr7+/vv7+/u7u3v7+37+/ru7uzw8PD////29vbx8fD6+vjq6unz8/L5+ff39/f9/f3y8vHo6Ofx8fHw8O/z8/P6+vn4+Pj09PL+/v729vXp6efy8vDv7+709PTz8/H7+/n8/Pv5+fju7u5JBELWAAAAAWJLR0QB/wIt3gAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+cFHw8tIWAQRK8AAAC5SURBVCjPpZDbEoIgEIaXQLPUNNFOWJrRyQ7v/3gJAs2EFzTuBex+8+/uDwDIiglgGyItJJ4/9YM+DxSczcMowvFCFgmk4lpmVEZeiGolYbCmKjZiQgp4i5C305CVPezOPTVxMLD6wrorj79K0U6kpaQxM0/GPIm5gmdilKise9ZI4UW96HoLGcN3ybpF+hPaomxV+oCn/Ukv4DZMgdqQOkMMb0clG4L5uO3/wAGf3Ll9UJk5Lxpr/gOpxRF8cA+lxgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0zMVQxMzo0NTozMyswMjowMJXHbJYAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMzFUMTM6NDU6MzMrMDI6MDDkmtQqAAAAAElFTkSuQmCC);
background-repeat: repeat-y;
background-size: 20px;
padding-left: 16px;
background-color: #fafafa;
tab-size: 4;
-moz-tab-size: 4;
font-size: 2vh;
}
.srcfile code {
margin-left: 0px;
padding-right: 20px;
padding: 0 0 0 0;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAMAAAB1cTk3AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAjVBMVEX9/fz4+Pb19fP8/Pz39/Xp6ejr6+rs7Ov29vTt7evo6Oj6+vr7+/vv7+/u7u3v7+37+/ru7uzw8PD////29vbx8fD6+vjq6unz8/L5+ff39/f9/f3y8vHo6Ofx8fHw8O/z8/P6+vn4+Pj09PL+/v729vXp6efy8vDv7+709PTz8/H7+/n8/Pv5+fju7u5JBELWAAAAAWJLR0QB/wIt3gAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+cFHw8tIWAQRK8AAAC5SURBVCjPpZDbEoIgEIaXQLPUNNFOWJrRyQ7v/3gJAs2EFzTuBex+8+/uDwDIiglgGyItJJ4/9YM+DxSczcMowvFCFgmk4lpmVEZeiGolYbCmKjZiQgp4i5C305CVPezOPTVxMLD6wrorj79K0U6kpaQxM0/GPIm5gmdilKise9ZI4UW96HoLGcN3ybpF+hPaomxV+oCn/Ukv4DZMgdqQOkMMb0clG4L5uO3/wAGf3Ll9UJk5Lxpr/gOpxRF8cA+lxgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wNS0zMVQxMzo0NTozMyswMjowMJXHbJYAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDUtMzFUMTM6NDU6MzMrMDI6MDDkmtQqAAAAAElFTkSuQmCC);
background-repeat: repeat-y;
background-position: right top;
background-size: 20px;
display: block;
text-align: left;
font-family: Inconsolata, monospace;
overflow: hidden;
}
.srcfile ol {
margin-left: 0vw;
padding-left: 3vw;
}
.srcfile ol li {
white-space: pre;
}
.srcfile ol li::marker {
color: RGB(0,0,0,0.2);
}
.srcfile ol li:hover {
background-color: RGB(180,238,180,0.3);
}
.srcfile code i {
font-style: normal;
color: #a2a2a2;
}
.keyword {
color: darkviolet;
}
.type {
color: dodgerblue;
}
.comment, .comment>span {
color: darkgreen;
}
.header {
background-color: #f6f5f4;
border-bottom: 1px inset #000;
}
.page .footer {
bottom: 1vh;
}
.right>*, .right .shell {
margin-right: 1em;
}
.toc {
font-size: 0.9em;
}
.shell {
padding: 1em;
border-radius: 10px;
overflow: wrap;
}
.dark {
background-color: #2e2e34;
color: aliceblue;
}
nav {
column-count: 2;
font-size: 0.8em;
}
.srcfile ol {
padding-right: 40px;
}
.shell {
font-size: 1.5vw;
}
p>a {
text-decoration: underline;
}
quote {
display: inline-block;
font-style: italic;
padding-left: 2vw;
padding-right: 2vw;
font-size: 1.5vw;
}
quote>a {
font-size: 1vw;
float: right;
}
quote.small {
font-size: 1vw;
}
.pictogram {
display: block;
width: 400px;
text-align: center;
padding: 1em 1em;
margin: 1em auto;
}
.pictogram label {
font-style: italic;
font-size: 0.6em;
}
.srcfile {
font-size: 1.3vw;
}
.filename {
display: block;
font-size: 0.8vw;
text-align: right;
margin-top: 2em;
margin-bottom: -2em;
}
.icons {
column-count: 3;
list-style-type: none;
}
.small * {
font-size: 0.9vw;
}
.small .filename {
margin-bottom: -1.5em;
}
.stop>img {
text-align: center;
float:left;
margin-right: 20px;
}
.stop>p {
padding-top: 50px;
color: red;
}
.narrow {
display: block;
margin: auto auto;
width: 70%;
}
.structures {
width: 100%;
}
.structures td {
vertical-align: top;
padding-right: 1em;
}
.structures td * {
font-size: 0.7em;
}
.structures, td.wide {
width: 100%;
}
.f {
float: left;
margin-right: 0.1em;
}
.f>.srcfile {
font-size: 17px;
}
.f>.filename {
margin-bottom: -20px;
}
.summary tr td:first-child {
padding-right: 2em;
}
.summary tr th {
text-align: left;
border-bottom: 1px solid black;
}
.courses {
width: 100%;
}
.courses tr td {
vertical-align: top;
width: 33%;
}
.course {
font-size: 1em;
width: 80%;
border: 5px double black;
padding: 1em 1em;
text-align: center;
}
.done {
color: #e2e2e2;
border: 5px double #e2e2e2;
}
.maybe {
color: #e2e2e2;
}
.later {
border: 5px dashed #e2e2e2;
}
</style>
</head>
<body>
<div class="page" id="1"><div class="view"><div class="cover"><table>
<tr><td><h1>Backend development</h1>
</td></tr>
<tr><td><img src="img/coverpage.svg"/></td></tr>
<tr><td><br/>Gregory Vinčić</td></tr>
</table>
</div>
</div>
<div class="footer"><em class="prev">&nbsp;</em><em class="next">&nbsp;</em>1/33</div>
</div>
<div class="page" id="2"><div class="view"><div class="header"><h2>Backend development</h2>
</div>
<div class="slide"><div class="toc"><nav><ul>
<li class="h2"><a href="#3">History</a></li>
<li class="h2"><a href="#4">Quick install</a></li>
<li class="h2"><a href="#5">Project structure</a></li>
<li class="h2"><a href="#6">Concepts</a></li>
<li class="h3"><a href="#7">Module</a></li>
<li class="h3"><a href="#8">Package</a></li>
<li class="h3"><a href="#9">Interface</a></li>
<li class="h2"><a href="#10">HTTP</a></li>
<li class="h3"><a href="#11">Direct</a></li>
<li class="h3"><a href="#12">Closure</a></li>
<li class="h3"><a href="#13">Method</a></li>
<li class="h3"><a href="#14">Combo</a></li>
<li class="h2"><a href="#15">Route</a></li>
<li class="h3"><a href="#16">Naive</a></li>
<li class="h3"><a href="#17">Default http.ServeMux</a></li>
<li class="h3"><a href="#18">Your own http.ServeMux</a></li>
<li class="h3"><a href="#19">Path value</a></li>
<li class="h2"><a href="#20">Encode</a></li>
<li class="h3"><a href="#21">encoding/json</a></li>
<li class="h3"><a href="#22">Nice json</a></li>
<li class="h3"><a href="#23">Struct tags</a></li>
<li class="h3"><a href="#24">Complex struct</a></li>
<li class="h2"><a href="#25">Test</a></li>
<li class="h3"><a href="#26">http/httptest</a></li>
<li class="h3"><a href="#27">Coverage</a></li>
<li class="h2"><a href="#28">View</a></li>
<li class="h3"><a href="#29">html/template</a></li>
<li class="h3"><a href="#30">embed</a></li>
<li class="h2"><a href="#31">Complete example</a></li>
<li class="h2"><a href="#32">Summary</a></li>
<li class="h2"><a href="#33">Next time</a></li>
</ul>
</nav>
</div>
</div>
</div>
<div class="footer"><em class="prev">&nbsp;</em><em class="next" onclick="nextPage()">History &raquo;</em>2/33</div>
</div>
<div class="page" id="3"><div class="view"><div class="header"><h2>History</h2>
</div>
<div class="slide"><div class="narrow"><p>Robert Griesemer, Ken Thompson and Rob Pike are the
		original authors of the Go language which is currently
		supervised by Russ Cox. Ian wrote the first compiler as a
		frontend to gcc.</p>
</div>
<div class="double"><div class="column left" style="width: 52vw"><div class="center"><div class="small"><pre>The story

  1960       1970          1980          1990        2000      2007-2009

                                                +- Javascript  --+
                                               /                  \
                +----- C -----------------+---+ PHP/Perl        ---+
               /                           \                        \
- Algol ------+                             +-- Java             ----+- Go
               \                                                    /
                \       +--- Modula ---+-- Python               -- +
                 \     /                                          /
                  +---+----------+         o-- Ada 95            /
                  |               \                             /
              Pascal               +---- Oberon             ---+
</pre></div>
</div>
</div>
<div class="column right" style="left: 60vw; width: 40vw"><br/><img src="img/people.png"/><p>They needed a language for writing servers on
				modern multicore computers</p>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Backend development</em><em class="next" onclick="nextPage()">Quick install &raquo;</em>3/33</div>
</div>
<div class="page" id="4"><div class="view"><div class="header"><h2>Quick install</h2>
</div>
<div class="slide"><div style="position: absolute; left: 15vw; width: 70vw"><p>Download and install Go in the $HOME directory.</p>
<div class="center"><a href="https://go.dev/dl">https://go.dev/dl</a></div>
<pre class="shell dark">$ cd $HOME
$ wget https://go.dev/dl/go1.22.0.linux-amd64.tar.gz
$ tar xvfz go1.22.0.linux-amd64.tar.gz
$ export PATH="$PATH:$HOME/go/bin"
$ go version
go version go1.22.0 linux/amd64</pre><p>For more information refer to <a href="https://go.dev/doc/install">"Download and install"</a>.</p>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; History</em><em class="next" onclick="nextPage()">Project structure &raquo;</em>4/33</div>
</div>
<div class="page" id="5"><div class="view"><div class="header"><h2>Project structure</h2>
</div>
<div class="slide"><div style="position: absolute; left: 10vw; width: 80vw"><table class="structures wide">
<tr><td><pre class="shell dark">$ cd neon; tree/<br/>.
├── go.mod
├── main.go
└── main_test.go

0 directories, 3 files
</pre><quote>"A basic Go package has all its code in the project’s root directory."<br/><br/><a href="https://go.dev/doc/modules/layout">go.dev/doc/modules/layout</a></quote></td><td><pre class="shell dark">$ cd neon/; tree<br/>.
├── cmd
│   └── neon
│       ├── main.go
│       └── main_test.go
├── booking.go
├── go.mod
├── hotel.go
└── room.go

2 directories, 6 files
</pre></td><td><pre class="shell dark">$ cd neon/; tree<br/>.
├── cmd
│   └── neon
│       ├── booking.go
│       ├── hotel.go
│       ├── main.go
│       ├── main_test.go
│       └── room.go
├── internal
│   ├── crypt
│   ├── mqtt.go
│   └── postgres.go
└── go.mod

4 directories, 8 files
</pre><quote>"Server project"<br/><br/><a href="https://go.dev/doc/modules/layout#server-project">go.dev/doc/modules/layout#server-project</a></quote></td><td class="wide"><pre class="shell dark">$ cd neon/; tree<br/>.
├── cmd
│   └── neon
│       ├── main.go
│       └── main_test.go
├── internal
│   ├── crypt
│   ├── mqtt.go
│   └── postgres.go
├── booking.go
├── go.mod
├── hotel.go
├── room.go
└── system.go

4 directories, 9 files
</pre><quote>"Don't waste a good name"<br/><br/><a href="Gregory Vinčić">Gregory Vinčić</a></quote></td></tr>
</table>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Quick install</em><em class="next" onclick="nextPage()">Concepts &raquo;</em>5/33</div>
</div>
<div class="page" id="6"><div class="view"><div class="header"><h2>Concepts</h2>
</div>
<div class="slide"><div style="position: absolute; left: 15vw; width: 70vw"><p>In Go; <b>modules</b> are used to group
			<b>packages</b> and functions.</p>
<quote>"You can collect related packages into modules, then
		publish the modules for other developers to use."<br/><br/><a href="https://go.dev/doc/modules/developing">go.dev/doc/modules/developing</a></quote><br/><p>An <b>interface</b> describes behavior.</p>
<quote>"Interfaces in Go provide a way to specify the
			  behavior of an object: if something can do this, then it
			  can be used here."<br/><br/><a href="https://go.dev/doc/effective_go#interfaces_and_types">go.dev/doc/effective_go#interfaces_and_types</a></quote></div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Project structure</em><em class="next" onclick="nextPage()">Concepts Module &raquo;</em>6/33</div>
</div>
<div class="page" id="7"><div class="view"><div class="header"><div class="group">Concepts</div>
<h3>Module</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 42vw"><p>Modules are initiated using the repository URL.</p>
<pre class="shell dark">$ go mod init github.com/gregoryv/uptime</pre><p>This can then be used</p>
<pre class="shell dark">$ go get github.com/gregoryv/uptime[@VERSION]</pre><p>Find modules on <a href="https://pkg.go.dev">pkg.go.dev</a></p>
</div>
<div class="column right" style="left: 50vw; width: 50vw"><p>Sharing code with others requires dependency
				management.</p>
<div class="pictogram"><img src="img/pic_module.png"/><br/><label>Module</label></div>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Concepts</em><em class="next" onclick="nextPage()">Concepts Package &raquo;</em>7/33</div>
</div>
<div class="page" id="8"><div class="view"><div class="header"><div class="group">Concepts</div>
<h3>Package</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 42vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    "fmt"</li>
<li>    "time"</li>
<li></li>
<li>    "github.com/gregoryv/uptime"</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    start := time.Now()</li>
<li>    dur := uptime.Since(start)</li>
<li>    fmt.Println(dur.String())</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 50vw; width: 50vw"><br/><quote>"... package name should be good: short, concise, evocative. ...Use the package structure to help you choose good names. "<br/><br/><a href="https://go.dev/doc/effective_go#package-names">go.dev/doc/effective_go#package-names</a></quote><div class="pictogram"><img src="img/pic_package.png"/><br/><label>Package</label></div>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Concepts Module</em><em class="next" onclick="nextPage()">Concepts Interface &raquo;</em>8/33</div>
</div>
<div class="page" id="9"><div class="view"><div class="header"><div class="group">Concepts</div>
<h3>Interface</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 42vw"><br/><quote class="small">"Interfaces with only one or two methods are common in Go
			code, and are usually given a name derived from the
			method, such as io.Writer for something that implements
			Write."<br/><br/><a href="https://go.dev/doc/effective_go#interfaces_and_types">go.dev/doc/effective_go#interfaces_and_types</a></quote><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> fmt</li>
<li></li>
<li><span class="keyword">type</span> Stringer <span class="keyword">interface</span> {</li>
<li>    String() string</li>
<li>}</li>
</ol>
</code></div>
<div class="pictogram"><img src="img/pic_interface.png"/><br/><label>Interface</label></div>
</div>
<div class="column right" style="left: 50vw; width: 50vw"><div class="srcfile"><code><ol start="7">
<li><span class="keyword">func</span> main() {</li>
<li>    fmt.Println(painted(color(2)))</li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> painted(val fmt.Stringer) string {</li>
<li>    <span class="keyword">return</span> fmt.Sprintf("%T.String(): %s", val, val.String())</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> color int</li>
<li></li>
<li><span class="keyword">func</span> (c color) String() string {</li>
<li>    <span class="keyword">switch</span> c {</li>
<li>    <span class="keyword">case</span> 1:</li>
<li>        <span class="keyword">return</span> "red"</li>
<li>    <span class="keyword">case</span> 2:</li>
<li>        <span class="keyword">return</span> "green"</li>
<li>    <span class="keyword">default</span>:</li>
<li>        <span class="keyword">return</span> "white"</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Concepts Package</em><em class="next" onclick="nextPage()">HTTP &raquo;</em>9/33</div>
</div>
<div class="page" id="10"><div class="view"><div class="header"><h2>HTTP</h2>
</div>
<div class="slide"><div style="position: absolute; left: 16vw; width: 68vw"><p>Respond to HTTP requests in Go by implementing the
			http.Handler interface.</p>
<div class="srcfile"><code><ol>
<li><span class="keyword">package</span> http <span class="comment">// <span class="keyword">import</span> "net/http"</span></li>
<li></li>
<li><span class="comment">// A Handler responds to an HTTP request. Handler.ServeHTTP should</span></li>
<li><span class="comment">// write reply headers and data to the ResponseWriter and then <span class="keyword">return</span>.</span></li>
<li><span class="comment">// ...</span></li>
<li><span class="keyword">type</span> Handler <span class="keyword">interface</span> {</li>
<li>    ServeHTTP(ResponseWriter, *Request)</li>
<li>}</li>
<li></li>
<li><span class="comment">// The HandlerFunc <span class="keyword">type</span> is an adapter to allow the use of ordinary</span></li>
<li><span class="comment">// functions as HTTP handlers. If f is a function with the appropriate</span></li>
<li><span class="comment">// signature, HandlerFunc(f) is a Handler that calls f.</span></li>
<li><span class="keyword">type</span> HandlerFunc <span class="keyword">func</span>(ResponseWriter, *Request)</li>
<li></li>
<li><span class="keyword">func</span> (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) {</li>
<li>    f(w, r)</li>
<li>}</li>
</ol>
</code></div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Concepts Interface</em><em class="next" onclick="nextPage()">HTTP Direct &raquo;</em>10/33</div>
</div>
<div class="page" id="11"><div class="view"><div class="header"><div class="group">HTTP</div>
<h3>Direct</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 52vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    "fmt"</li>
<li>    "log"</li>
<li>    "net/http"</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    err := http.ListenAndServe(":8080", http.HandlerFunc(sayHello))</li>
<li>    <span class="keyword">if</span> err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> sayHello(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>    fmt.Fprint(w, "Hello, world!")</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 60vw; width: 40vw"><p>Direct design uses named functions as http
                handlers, implementing the http.HandlerFunc
                interface</p>
<div class="pictogram"><img src="img/pic_func.png"/><br/><label>Func</label></div>
<span class="small"><pre class="shell dark">$ go run helloworld.go</pre></span></div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; HTTP</em><em class="next" onclick="nextPage()">HTTP Closure &raquo;</em>11/33</div>
</div>
<div class="page" id="12"><div class="view"><div class="header"><div class="group">HTTP</div>
<h3>Closure</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 52vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    "fmt"</li>
<li>    "log"</li>
<li>    "net/http"</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    err := http.ListenAndServe(":8080", sayHello())</li>
<li>    <span class="keyword">if</span> err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> sayHello() http.HandlerFunc {</li>
<li>    txt := "Hello, world!"</li>
<li>    <span class="keyword">return</span> <span class="keyword">func</span>(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>        fmt.Fprint(w, txt)</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 60vw; width: 40vw"><p>Closure design uses named functions returning a
                http.HandlerFunc.</p>
<div class="pictogram"><img src="img/pic_closure.png"/><br/><label>Closure</label></div>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; HTTP Direct</em><em class="next" onclick="nextPage()">HTTP Method &raquo;</em>12/33</div>
</div>
<div class="page" id="13"><div class="view"><div class="header"><div class="group">HTTP</div>
<h3>Method</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 52vw"><div class="srcfile"><code><ol start="9">
<li><span class="keyword">func</span> main() {</li>
<li>    handler := &Greeter{</li>
<li>        <span class="comment">// complex setup</span></li>
<li>    }</li>
<li>    err := http.ListenAndServe(":8080", handler)</li>
<li>    <span class="keyword">if</span> err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Greeter <span class="keyword">struct</span> {</li>
<li>    <span class="comment">// complex relations, eg. database</span></li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> (g *Greeter) ServeHTTP(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>    fmt.Fprint(w, "Hello, world!")</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 60vw; width: 40vw"><p>Method design declares types that implement
				http.Handler</p>
<div class="pictogram"><img src="img/pic_method.png"/><br/><label>Method</label></div>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; HTTP Closure</em><em class="next" onclick="nextPage()">HTTP Combo &raquo;</em>13/33</div>
</div>
<div class="page" id="14"><div class="view"><div class="header"><div class="group">HTTP</div>
<h3>Combo</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 47vw"><span class="small"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    "fmt"</li>
<li>    "log"</li>
<li>    "net/http"</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    ctl := Controller{</li>
<li>        <span class="comment">// complex setup</span></li>
<li>    }</li>
<li></li>
<li>    <span class="keyword">if</span> err := http.ListenAndServe(":8080", ctl.sayHello()); err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Controller <span class="keyword">struct</span>{}</li>
<li></li>
<li><span class="keyword">func</span> (c *Controller) sayHello() http.HandlerFunc {</li>
<li>    <span class="keyword">return</span> <span class="keyword">func</span>(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>        fmt.Fprint(w, "Hello, world!")</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
</span></div>
<div class="column right" style="left: 55vw; width: 45vw"><p>Combo design declares types with multiple methods
				with http.HandlerFunc signature or return one (closure).</p>
<div class="pictogram"><img src="img/pic_combined_closure.png"/><br/><label>Combo</label></div>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; HTTP Method</em><em class="next" onclick="nextPage()">Route &raquo;</em>14/33</div>
</div>
<div class="page" id="15"><div class="view"><div class="header"><h2>Route</h2>
</div>
<div class="slide"><div style="position: absolute; left: 16vw; width: 68vw"><p>For systems serving many resources</p>
<div class="srcfile"><code><ol>
<li><span class="keyword">package</span> http</li>
<li></li>
<li><span class="comment">// ServeMux is an HTTP request multiplexer. It matches the URL of each</span></li>
<li><span class="comment">// incoming request against a list of registered patterns and calls</span></li>
<li><span class="comment">// the handler <span class="keyword">for</span> the pattern that most closely matches the URL.</span></li>
<li><span class="keyword">type</span> ServeMux <span class="keyword">struct</span> {</li>
<li>    <span class="comment">// Has unexported fields.</span></li>
<li>}</li>
</ol>
</code></div>
<pre>multiplexer
      n 1: a device that can interleave two or more activities
</pre></div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; HTTP Combo</em><em class="next" onclick="nextPage()">Route Naive &raquo;</em>15/33</div>
</div>
<div class="page" id="16"><div class="view"><div class="header"><div class="group">Route</div>
<h3>Naive</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 55vw"><div class="srcfile"><code><ol start="16">
<li><span class="keyword">func</span> (c *Controller) ServeHTTP(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>    <span class="keyword">switch</span> {</li>
<li>    <span class="keyword">case</span> r.URL.Path == "/bye" && r.Method == "GET":</li>
<li>        c.sayGoodbye(w, r)</li>
<li></li>
<li>    <span class="keyword">case</span> r.URL.Path == "/" && r.Method == "GET":</li>
<li>        c.sayHello(w, r)</li>
<li></li>
<li>    <span class="keyword">default</span>:</li>
<li>        http.Error(w, "routing failed", http.StatusBadRequest)</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 63vw; width: 37vw"><p>Manual routing.</p>
<div class="stop"><img src="img/stop.png"/><p>Error prone and complex.</p>
</div>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Route</em><em class="next" onclick="nextPage()">Route Default http.ServeMux &raquo;</em>16/33</div>
</div>
<div class="page" id="17"><div class="view"><div class="header"><div class="group">Route</div>
<h3>Default http.ServeMux</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 57vw"><div class="srcfile"><code><ol start="9">
<li><span class="keyword">func</span> main() {</li>
<li>    <span class="keyword">var</span> ctl Controller</li>
<li>    http.HandleFunc("GET /bye", ctl.sayGoodbye)</li>
<li>    http.HandleFunc("GET /", ctl.sayHello) <span class="comment">// everything <span class="keyword">else</span></span></li>
<li>    <span class="keyword">if</span> err := http.ListenAndServe(":8080", nil); err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Controller <span class="keyword">struct</span>{}</li>
<li></li>
<li><span class="keyword">func</span> (c *Controller) sayHello(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>    fmt.Fprint(w, "Hello, world!")</li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> (c *Controller) sayGoodbye(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>    fmt.Fprint(w, "Goodbye, world!")</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 65vw; width: 35vw"><p>Use http singleton ServeMux.</p>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Route Naive</em><em class="next" onclick="nextPage()">Route Your own http.ServeMux &raquo;</em>17/33</div>
</div>
<div class="page" id="18"><div class="view"><div class="header"><div class="group">Route</div>
<h3>Your own http.ServeMux</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 55vw"><div class="srcfile"><code><ol start="9">
<li><span class="keyword">func</span> main() {</li>
<li>    <span class="keyword">var</span> ctl Controller</li>
<li></li>
<li>    mux := http.NewServeMux()</li>
<li>    mux.HandleFunc("GET /bye", ctl.sayGoodbye)</li>
<li>    mux.HandleFunc("GET /", ctl.sayHello)</li>
<li></li>
<li>    <span class="keyword">if</span> err := http.ListenAndServe(":8080", mux); err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Controller <span class="keyword">struct</span>{}</li>
<li></li>
<li><span class="keyword">func</span> (c *Controller) sayHello(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>    fmt.Fprint(w, "Hello, world!")</li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> (c *Controller) sayGoodbye(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>    fmt.Fprint(w, "Goodbye, world!")</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 63vw; width: 37vw"><p>Create your own http.ServeMux.</p>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Route Default http.ServeMux</em><em class="next" onclick="nextPage()">Route Path value &raquo;</em>18/33</div>
</div>
<div class="page" id="19"><div class="view"><div class="header"><div class="group">Route</div>
<h3>Path value</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 46vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    "encoding/json"</li>
<li>    "log"</li>
<li>    "net/http"</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    <span class="comment">// available people, ie. our data store</span></li>
<li>    people := []Person{</li>
<li>        {Id: "p1", Name: "John"},</li>
<li>        {Id: "p2", Name: "Jane"},</li>
<li>    }</li>
<li>    mux := http.NewServeMux()</li>
<li>    mux.Handle("GET /person/{id}", servePersonById(people))</li>
<li></li>
<li>    <span class="keyword">if</span> err := http.ListenAndServe(":8080", mux); err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 54vw; width: 46vw"><div class="srcfile"><code><ol start="23">
<li><span class="keyword">func</span> servePersonById(people []Person) http.HandlerFunc {</li>
<li>    <span class="keyword">return</span> <span class="keyword">func</span>(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>        id := r.PathValue("id")</li>
<li>        <span class="keyword">for</span> _, person := <span class="keyword">range</span> people {</li>
<li>            <span class="keyword">if</span> person.Id == id {</li>
<li>                json.NewEncoder(w).Encode(person)</li>
<li>                <span class="keyword">return</span></li>
<li>            }</li>
<li>        }</li>
<li>        <span class="comment">// ... handle not found</span></li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Person <span class="keyword">struct</span> {</li>
<li>    Id   string</li>
<li>    Name string</li>
<li>}</li>
</ol>
</code></div>
<div class="pictogram"><img src="img/pic_closure.png"/><br/><label>Closure</label></div>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Route Your own http.ServeMux</em><em class="next" onclick="nextPage()">Encode &raquo;</em>19/33</div>
</div>
<div class="page" id="20"><div class="view"><div class="header"><h2>Encode</h2>
</div>
<div class="slide"><div style="position: absolute; left: 20vw; width: 60vw"><p>From the dictionary</p>
<pre>encode
  
    &lt;algorithm, hardware&gt; To convert {data} or some physical
    quantity into a given format.  E.g. {uuencode}.
</pre><p>In Go this equals to marshal <code>type X</code> to <code>[]byte</code></p>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Route Path value</em><em class="next" onclick="nextPage()">Encode encoding/json &raquo;</em>20/33</div>
</div>
<div class="page" id="21"><div class="view"><div class="header"><div class="group">Encode</div>
<h3>encoding/json</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 42vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    "encoding/json"</li>
<li>    "fmt"</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    user := Contact{</li>
<li>        Firstname: "John",</li>
<li>        Lastname:  "Doe",</li>
<li>        Age:       23,</li>
<li>        Alive:     true,</li>
<li>    }</li>
<li>    data, _ := json.Marshal(user)</li>
<li>    fmt.Print(string(data))</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Contact <span class="keyword">struct</span> {</li>
<li>    Firstname string</li>
<li>    Lastname  string</li>
<li>    Age       int</li>
<li>    Alive     bool</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 50vw; width: 50vw"><pre class="shell dark">$ go run ./examples/encoding.go<br/>{"Firstname":"John","Lastname":"Doe","Age":23,"Alive":true}</pre></div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Encode</em><em class="next" onclick="nextPage()">Encode Nice json &raquo;</em>21/33</div>
</div>
<div class="page" id="22"><div class="view"><div class="header"><div class="group">Encode</div>
<h3>Nice json</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 52vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    "encoding/json"</li>
<li>    "fmt"</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    user := Contact{</li>
<li>        Firstname: "John",</li>
<li>        Lastname:  "Doe",</li>
<li>        Age:       23,</li>
<li>        Alive:     true,</li>
<li>    }</li>
<li>    data, _ := json.MarshalIndent(user, "", "  ")</li>
<li>    fmt.Print(string(data))</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Contact <span class="keyword">struct</span> {</li>
<li>    Firstname string</li>
<li>    Lastname  string</li>
<li>    Age       int</li>
<li>    Alive     bool</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 60vw; width: 40vw"><pre class="shell dark">$ go run ./examples/nicejson.go<br/>{
  "Firstname": "John",
  "Lastname": "Doe",
  "Age": 23,
  "Alive": true
}</pre></div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Encode encoding/json</em><em class="next" onclick="nextPage()">Encode Struct tags &raquo;</em>22/33</div>
</div>
<div class="page" id="23"><div class="view"><div class="header"><div class="group">Encode</div>
<h3>Struct tags</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 52vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    "encoding/json"</li>
<li>    "fmt"</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    user := Contact{</li>
<li>        Firstname: "John",</li>
<li>        Lastname:  "Doe",</li>
<li>    }</li>
<li>    data, _ := json.MarshalIndent(user, "", "  ")</li>
<li>    fmt.Print(string(data))</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Contact <span class="keyword">struct</span> {</li>
<li>    Firstname string `json:"firstname"` <span class="comment">// change name</span></li>
<li>    Lastname  string `json:"-"`         <span class="comment">// ignore this field</span></li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 60vw; width: 40vw"><p>Control naming of fields, eg. lowercase names.</p>
<pre class="shell dark">$ go run ./examples/fieldtags.go<br/>{
  "firstname": "John"
}</pre></div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Encode Nice json</em><em class="next" onclick="nextPage()">Encode Complex struct &raquo;</em>23/33</div>
</div>
<div class="page" id="24"><div class="view"><div class="header"><div class="group">Encode</div>
<h3>Complex struct</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 54vw"><div class="srcfile"><code><ol start="20">
<li><span class="keyword">type</span> Contact <span class="keyword">struct</span> {</li>
<li>    Firstname string `json:"firstname"` <span class="comment">// change name</span></li>
<li>    Lastname  string `json:"-"`         <span class="comment">// ignore this field</span></li>
<li>    *Address  `json:"address"`</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Address <span class="keyword">struct</span> {</li>
<li>    Street     string `json:"street"`</li>
<li>    Number     uint   `json:"no"`                    <span class="comment">// rename entirely</span></li>
<li>    PostalCode int    `json:"postal_code,omitempty"` <span class="comment">// skip empty value</span></li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 62vw; width: 38vw"><pre class="shell dark">$ go run ./examples/complex_struct.go<br/>{
  "firstname": "John",
  "address": {
    "street": "Lexington road",
    "no": 137
  }
}</pre></div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Encode Struct tags</em><em class="next" onclick="nextPage()">Test &raquo;</em>24/33</div>
</div>
<div class="page" id="25"><div class="view"><div class="header"><h2>Test</h2>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 42vw"><div class="filename">main_test.go</div>
<div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> "testing"</li>
<li></li>
<li><span class="keyword">func</span> TestSum(t *testing.T) {</li>
<li>    <span class="keyword">if</span> s := Sum(1, 2); s != 3 {</li>
<li>        t.Errorf("got %v, expect 3", s)</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
<div class="filename">main.go</div>
<div class="srcfile"><code><ol start="6">
<li><span class="keyword">func</span> Sum(a, b int) int {</li>
<li>    <span class="keyword">return</span> a + b</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 50vw; width: 50vw"><pre>.
├── go.mod
├── main.go
└── main_test.go

0 directories, 3 files
</pre><pre class="shell dark">$ go test -v .<br/>=== RUN   TestSum
--- PASS: TestSum (0.00s)
PASS
ok  	github.com/gregoryv/project	0.001s
</pre></div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Encode Complex struct</em><em class="next" onclick="nextPage()">Test http/httptest &raquo;</em>25/33</div>
</div>
<div class="page" id="26"><div class="view"><div class="header"><div class="group">Test</div>
<h3>http/httptest</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 52vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    "net/http"</li>
<li>    "net/http/httptest"</li>
<li>    "testing"</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> Test_sayHello(t *testing.T) {</li>
<li>    <span class="comment">// prepare response recorder and request</span></li>
<li>    w := httptest.NewRecorder()</li>
<li>    r := httptest.NewRequest("GET", "/", http.NoBody)</li>
<li></li>
<li>    <span class="comment">// call handler</span></li>
<li>    handler := sayHello() <span class="comment">// using the closure design</span></li>
<li>    handler(w, r)</li>
<li></li>
<li>    <span class="comment">// check result</span></li>
<li>    resp := w.Result()</li>
<li>    <span class="keyword">if</span> v := resp.StatusCode; v != 200 {</li>
<li>        t.Error(resp.Status)</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 60vw; width: 40vw"><p>Quick unit test of specific handlers using httptest.Recorder</p>
<ol>
<li>setup</li>
<li>call handler</li>
<li>check response</li>
</ol>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Test</em><em class="next" onclick="nextPage()">Test Coverage &raquo;</em>26/33</div>
</div>
<div class="page" id="27"><div class="view"><div class="header"><div class="group">Test</div>
<h3>Coverage</h3>
</div>
<div class="slide"><pre class="shell dark">$ go test -v -cover .<br/>=== RUN   Test_sayHello
--- PASS: Test_sayHello (0.00s)
PASS
coverage: 60.0% of statements
ok  	goback/examples/httptest	0.002s	coverage: 60.0% of statements
</pre><div class="small"><div class="double"><div class="column left" style="width: 42vw"><div class="filename">main_test.go</div>
<div class="srcfile"><code><ol start="9">
<li><span class="keyword">func</span> Test_sayHello(t *testing.T) {</li>
<li>    <span class="comment">// prepare response recorder and request</span></li>
<li>    w := httptest.NewRecorder()</li>
<li>    r := httptest.NewRequest("GET", "/", http.NoBody)</li>
<li></li>
<li>    <span class="comment">// call handler</span></li>
<li>    handler := sayHello() <span class="comment">// using the closure design</span></li>
<li>    handler(w, r)</li>
<li></li>
<li>    <span class="comment">// check result</span></li>
<li>    resp := w.Result()</li>
<li>    <span class="keyword">if</span> v := resp.StatusCode; v != 200 {</li>
<li>        t.Error(resp.Status)</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 50vw; width: 50vw"><div class="filename">main.go</div>
<div class="srcfile"><code><ol start="9">
<li><span class="keyword">func</span> main() {</li>
<li>    <span class="keyword">if</span> err := http.ListenAndServe(":8080", sayHello()); err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> sayHello() http.HandlerFunc {</li>
<li>    txt := "Hello, world!"</li>
<li>    <span class="keyword">return</span> <span class="keyword">func</span>(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>        fmt.Fprint(w, txt)</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
</div>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Test http/httptest</em><em class="next" onclick="nextPage()">View &raquo;</em>27/33</div>
</div>
<div class="page" id="28"><div class="view"><div class="header"><h2>View</h2>
</div>
<div class="slide"><div style="position: absolute; left: 20vw; width: 60vw"><p>Serverside rendered HTML for several use cases</p>
<ul>
<li>The obvious, you love the old school</li>
<li>API docs</li>
<li>Server stats</li>
<li>Performance, improve user experience and load times</li>
</ul>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Test Coverage</em><em class="next" onclick="nextPage()">View html/template &raquo;</em>28/33</div>
</div>
<div class="page" id="29"><div class="view"><div class="header"><div class="group">View</div>
<h3>html/template</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 44vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    &#34;html/template&#34;</li>
<li>    &#34;log&#34;</li>
<li>    &#34;os&#34;</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    tpl, err := template.ParseFiles(&#34;examples/index.html&#34;)</li>
<li>    <span class="keyword">if</span> err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li></li>
<li>    model := map[string]any{</li>
<li>        &#34;Title&#34;: &#34;&lt;script&gt;alert(&#39;WOW&#39;);&lt;/script&gt;&#34;,</li>
<li>    }</li>
<li>    <span class="keyword">if</span> err := tpl.Execute(os.Stdout, model); err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 52vw; width: 48vw"><div class="srcfile"><code><ol>
<li>&lt;html&gt;</li>
<li>&lt;body&gt;</li>
<li></li>
<li>&lt;h1&gt;{{.Title}}&lt;/h1&gt;</li>
<li></li>
<li>&lt;/body&gt;</li>
<li>&lt;/html&gt;</li>
</ol>
</code></div>
<pre class="shell dark">$ go run examples/htmltpl.go<br/>&lt;html&gt;
&lt;body&gt;

&lt;h1&gt;&amp;lt;script&amp;gt;alert(&amp;#39;WOW&amp;#39;);&amp;lt;/script&amp;gt;&lt;/h1&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; View</em><em class="next" onclick="nextPage()">View embed &raquo;</em>29/33</div>
</div>
<div class="page" id="30"><div class="view"><div class="header"><div class="group">View</div>
<h3>embed</h3>
</div>
<div class="slide"><div class="double"><div class="column left" style="width: 45vw"><div class="srcfile"><code><ol>
<li><span class="keyword">package</span> main</li>
<li></li>
<li><span class="keyword">import</span> (</li>
<li>    &#34;embed&#34;</li>
<li>    &#34;html/template&#34;</li>
<li>    &#34;log&#34;</li>
<li>    &#34;os&#34;</li>
<li>)</li>
<li></li>
<li><span class="keyword">func</span> main() {</li>
<li>    model := map[string]any{</li>
<li>        &#34;Title&#34;: &#34;&lt;script&gt;alert(&#39;WOW&#39;);&lt;/script&gt;&#34;,</li>
<li>    }</li>
<li>    err := tpl.ExecuteTemplate(os.Stdout, &#34;index.html&#34;, model)</li>
<li>    <span class="keyword">if</span> err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">var</span> tpl *template.Template = template.Must(</li>
<li>    template.ParseFS(assets, &#34;assets/*.html&#34;),</li>
<li>)</li>
<li></li>
<li><span class="comment">//<span class="keyword">go</span>:embed assets/*.html</span></li>
<li><span class="keyword">var</span> assets embed.FS</li>
</ol>
</code></div>
</div>
<div class="column right" style="left: 53vw; width: 47vw"><p><quote>"Package embed provides access to files embedded in the running Go program."<br/><br/><a href="https://pkg.go.dev/embed">pkg.go.dev/embed</a></quote><pre class="shell dark">$ go run examples/embed.go<br/>&lt;html&gt;
&lt;body&gt;

&lt;h1&gt;&amp;lt;script&amp;gt;alert(&amp;#39;WOW&amp;#39;);&amp;lt;/script&amp;gt;&lt;/h1&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></p>
</div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; View html/template</em><em class="next" onclick="nextPage()">Complete example &raquo;</em>30/33</div>
</div>
<div class="page" id="31"><div class="view"><div class="header"><h2>Complete example</h2>
</div>
<div class="slide"><div class="f"><div class="filename">main.go</div>
<div class="srcfile"><code><ol start="9">
<li><span class="keyword">func</span> main() {</li>
<li>    h := &Hotel{</li>
<li>        Name: "Purple glow",</li>
<li>        Rooms: []Room{</li>
<li>            {Number: "1"},</li>
<li>            {Number: "2"},</li>
<li>            {Number: "3"},</li>
<li>        },</li>
<li>    }</li>
<li></li>
<li>    mux := http.NewServeMux()</li>
<li>    mux.Handle("POST /room/{number}", BookRoom(h.Rooms))</li>
<li>    mux.Handle("GET /room", ServeRooms(h.Rooms))</li>
<li>    mux.Handle("GET /", ServeHotel(h))</li>
<li></li>
<li>    <span class="keyword">if</span> err := http.ListenAndServe(":8080", mux); err != nil {</li>
<li>        log.Fatal(err)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Hotel <span class="keyword">struct</span> {</li>
<li>    Name  string `json:"name"`</li>
<li>    Rooms []Room `json:"-"` <span class="comment">// rooms are rendered separately</span></li>
<li>}</li>
<li></li>
<li><span class="keyword">type</span> Room <span class="keyword">struct</span> {</li>
<li>    Number string `json:"number"` <span class="comment">// using string <span class="keyword">for</span> simplicty</span></li>
<li>    Booked bool   `json:"booked"`</li>
<li>}</li>
</ol>
</code></div>
<div class="center"><img src="img/neon_design.svg"/></div>
</div>
<div class="f"><div class="filename">main.go (continued)</div>
<div class="srcfile"><code><ol start="39">
<li><span class="keyword">func</span> BookRoom(rooms []Room) http.HandlerFunc {</li>
<li>    <span class="keyword">return</span> <span class="keyword">func</span>(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>        number := r.PathValue("number")</li>
<li>        <span class="comment">// update room state</span></li>
<li>        <span class="keyword">for</span> i, room := <span class="keyword">range</span> rooms {</li>
<li>            <span class="keyword">if</span> room.Number != number {</li>
<li>                continue</li>
<li>            }</li>
<li>            rooms[i].Booked = true</li>
<li>        }</li>
<li>        json.NewEncoder(w).Encode(rooms)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> ServeRooms(rooms []Room) http.HandlerFunc {</li>
<li>    <span class="keyword">return</span> <span class="keyword">func</span>(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>        json.NewEncoder(w).Encode(rooms)</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> ServeHotel(h *Hotel) http.HandlerFunc {</li>
<li>    <span class="keyword">return</span> <span class="keyword">func</span>(w <span class="type">http.ResponseWriter</span>, r *<span class="type">http.Request</span>) {</li>
<li>        json.NewEncoder(w).Encode(h)</li>
<li>    }</li>
<li>}</li>
</ol>
</code></div>
<div class="small"><pre class="shell dark">$ cd neon/; tree<br/>.
├── go.mod
├── main.go
└── main_test.go

0 directories, 3 files
</pre></div>
</div>
<div class="f"><div class="filename">main_test.go</div>
<div class="srcfile"><code><ol start="9">
<li><span class="keyword">func</span> Test_main(t *testing.T) {</li>
<li>    <span class="keyword">go</span> main()</li>
<li>    <-time.After(time.Millisecond) <span class="comment">// bad test strategy</span></li>
<li></li>
<li>    cases := []<span class="keyword">struct</span> {</li>
<li>        exp int <span class="comment">// expected status code</span></li>
<li>        *<span class="type">http.Request</span></li>
<li>    }{</li>
<li>        {200, newRequest(t, "POST", "http:<span class="comment">//localhost:8080/room/1")},</span></li>
<li>        {200, newRequest(t, "GET", "http:<span class="comment">//localhost:8080/room")},</span></li>
<li>        {200, newRequest(t, "GET", "http:<span class="comment">//localhost:8080/")},</span></li>
<li>    }</li>
<li>    <span class="keyword">for</span> _, c := <span class="keyword">range</span> cases {</li>
<li>        resp, err := http.DefaultClient.Do(c.Request)</li>
<li>        <span class="keyword">if</span> err != nil {</li>
<li>            t.Fatal(err)</li>
<li>        }</li>
<li>        <span class="keyword">if</span> resp.StatusCode != c.exp {</li>
<li>            t.Error(resp.Status)</li>
<li>        }</li>
<li>    }</li>
<li>}</li>
<li></li>
<li><span class="keyword">func</span> newRequest(t *testing.T, method, path string) *<span class="type">http.Request</span> {</li>
<li>    r, err := http.NewRequest(method, path, http.NoBody)</li>
<li>    <span class="keyword">if</span> err != nil {</li>
<li>        t.Fatal(err)</li>
<li>    }</li>
<li>    <span class="keyword">return</span> r</li>
<li>}</li>
</ol>
</code></div>
<div class="small"><pre class="shell dark">$ go test -v -cover .<br/>=== RUN   Test_main
--- PASS: Test_main (0.00s)
PASS
coverage: 94.4% of statements
ok      github.com/   0.006s  [0m...
</pre></div>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; View embed</em><em class="next" onclick="nextPage()">Summary &raquo;</em>31/33</div>
</div>
<div class="page" id="32"><div class="view"><div class="header"><h2>Summary</h2>
</div>
<div class="slide"><div style="position: absolute; left: 15vw; width: 70vw"><p>Concepts covered in this presentation</p>
<table class="summary">
<tr><th colspan="2">Go language/structure</th></tr>
<tr><td>module</td><td>for dependency management</td></tr>
<tr><td>package</td><td>grouping related code</td></tr>
<tr><td>interface</td><td>behavior abstraction</td></tr>
<tr><th colspan="2"><br/>Package</th></tr>
<tr><td>net/http</td><td>handling requests and routing</td></tr>
<tr><td>net/http/httptest</td><td>utilities for HTTP testing</td></tr>
<tr><td>testing</td><td>automated testing of Go packages</td></tr>
<tr><td>encoding/json</td><td>marshaling datatypes to JSON</td></tr>
<tr><td>html/template</td><td>rendering HTML</td></tr>
<tr><td>embed</td><td>provides access to embedded files</td></tr>
</table>
</div>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Complete example</em><em class="next" onclick="nextPage()">Next time &raquo;</em>32/33</div>
</div>
<div class="page" id="33"><div class="view"><div class="header"><h2>Next time</h2>
</div>
<div class="slide"><br/><table class="courses">
<tr><td><div class="course done">Backend development</div>
</td><td><div class="course">General problems</div>
<ol>
<li>Test driven development</li>
<li>Package testdata</li>
<li>Documentation</li>
<li>Logging</li>
<li>Error handling</li>
<li>Database IO</li>
</ol>
</td><td><div class="course later"><em>Concurrency problems</em></div>
<ol class="maybe">
<li>Concurrency</li>
<li>Benchmark</li>
<li>Testing strategy</li>
<li>... more</li>
</ol>
</td></tr>
</table>
</div>
</div>
<div class="footer"><em class="prev" onclick="previousPage()">&laquo; Summary</em><em class="next">&nbsp;</em>33/33</div>
</div>
</body>
<script>document.addEventListener('keydown', function(event) {
    if (previousPageKey(event)) {
	event.preventDefault()		
	previousPage()
	return
    }
    if (nextPageKey(event)) {
	event.preventDefault()
	nextPage()
	return
    }
    if (event.key === 'Home') {
	pageIndex = 1
	event.preventDefault()
	window.location.hash = pageIndex	
    }
    if (event.key === 'End') {
	pageIndex = last
	event.preventDefault()
	window.location.hash = pageIndex	
    }
    if (event.key === 't') {
	pageIndex = 2 // toc
	event.preventDefault()
	window.location.hash = pageIndex	
    }
    return
})

window.addEventListener('resize', function() {
    window.location.hash = getPos()
});

const last = document.querySelectorAll('.page').length;

function previousPage() {
    let pageIndex = getPos()
    if (pageIndex > 1) {
	pageIndex--
	window.location.hash = pageIndex
    }
}

function nextPage() {
    let pageIndex = getPos()
    if (pageIndex < last) {
	pageIndex++
	window.location.hash = pageIndex
    }
}

function previousPageKey(event) {
    return event.key === 'ArrowLeft' ||
	    event.key === 'ArrowUp' ||
	    event.key === 'PageUp'
}

function nextPageKey(event) {
    return event.key === 'ArrowRight' ||
	    event.key === 'ArrowDown' ||
	    event.key === 'PageDown'
}

function getPos() {
    let currentView = window.location.hash
    if (currentView === '') {
	currentView = "#1"
    }
    return parseInt(currentView.split('#').join(''))
}

// dots is an array of Dot objects,
// mouse is an object used to track the X and Y position
   // of the mouse, set with a mousemove event listener below
var dots = [],
    mouse = {
      x: 0,
      y: 0
    };

// The Dot object used to scaffold the dots
var Dot = function() {
  this.x = 0;
  this.y = 0;
  this.node = (function(){
    var n = document.createElement("div");
    n.className = "trail";
    document.body.appendChild(n);
    return n;
  }());
};
// The Dot.prototype.draw() method sets the position of 
  // the object's <div> node
Dot.prototype.draw = function() {
  this.node.style.left = this.x + "px";
  this.node.style.top = this.y + "px";
};

// Creates the Dot objects, populates the dots array
for (var i = 0; i < 12; i++) {
  var d = new Dot();
  dots.push(d);
}

// This is the screen redraw function
function draw() {
  // Make sure the mouse position is set everytime
    // draw() is called.
  var x = mouse.x,
      y = mouse.y;
  
  // This loop is where all the 90s magic happens
  dots.forEach(function(dot, index, dots) {
    var nextDot = dots[index + 1] || dots[0];
    
    dot.x = x;
    dot.y = y;
    dot.draw();
    x += (nextDot.x - dot.x) * .6;
    y += (nextDot.y - dot.y) * .6;

  });
}

addEventListener("mousemove", function(event) {
  //event.preventDefault();
  mouse.x = event.pageX;
  mouse.y = event.pageY;
});

// animate() calls draw() then recursively calls itself
  // everytime the screen repaints via requestAnimationFrame().
function animate() {
  draw();
  requestAnimationFrame(animate);
}

// And get it started by calling animate().
animate();
</script>
</html>
